<mat-card class="cardWithShadow">
  <mat-card-content>
    <mat-card-title>Table des utilisateurs</mat-card-title>
<!-- Filtres et Recherche -->
<div class="filters">
  <div class="left-filters">
    <mat-form-field appearance="outline">
      <mat-label>Filtrer par job</mat-label>
      <mat-select [(value)]="selectedJob" (selectionChange)="applyFilter()">
        <mat-option *ngFor="let job of uniqueJobs" [value]="job">{{ job }}</mat-option>
      </mat-select>
    </mat-form-field>
  </div>

  <div class="right-filters">
    <mat-form-field appearance="outline">
      <mat-label>Rechercher</mat-label>
      <input matInput [(ngModel)]="searchQuery" (input)="applyFilter()" placeholder="Rechercher...">
    </mat-form-field>

    <!-- Icône de réinitialisation -->
    <button mat-icon-button color="primary" (click)="resetFilters()">
      <mat-icon>clear</mat-icon>
    </button>
  </div>
</div>


    <div class="table-responsive">
      <table mat-table [dataSource]="dataSource" class="w-100">
        
        <!-- Column "photo" -->
<ng-container matColumnDef="photo">
  <th mat-header-cell *matHeaderCellDef class="f-w-600 mat-subtitle-1 f-s-14 p-l-0">Photo</th>
  <td mat-cell *matCellDef="let element" class="p-l-0">
    <!-- Icône de photo -->
    <mat-icon>account_circle</mat-icon> <!-- Choisis une icône de ton choix -->
  </td>
</ng-container>

        <!-- Column "name" -->
        <ng-container matColumnDef="name">
          <th mat-header-cell *matHeaderCellDef class="f-w-600 mat-subtitle-1 f-s-14">Nom</th>
          <td mat-cell *matCellDef="let element">
            <ng-container *ngIf="element.isEditing; else showName">
              <input [(ngModel)]="element.name" />
            </ng-container>
            <ng-template #showName>{{ element.name }}</ng-template>
          </td>
        </ng-container>

        <!-- Column "surname" -->
        <ng-container matColumnDef="surname">
          <th mat-header-cell *matHeaderCellDef class="f-w-600 mat-subtitle-1 f-s-14">Prénom</th>
          <td mat-cell *matCellDef="let element">
            <ng-container *ngIf="element.isEditing; else showSurname">
              <input [(ngModel)]="element.surname" />
            </ng-container>
            <ng-template #showSurname>{{ element.surname }}</ng-template>
          </td>
        </ng-container>

        <!-- Column "email" -->
        <ng-container matColumnDef="email">
          <th mat-header-cell *matHeaderCellDef class="f-w-600 mat-subtitle-1 f-s-14">Email</th>
          <td mat-cell *matCellDef="let element">
            <ng-container *ngIf="element.isEditing; else showEmail">
              <input [(ngModel)]="element.email" />
            </ng-container>
            <ng-template #showEmail>{{ element.email }}</ng-template>
          </td>
        </ng-container>

        <!-- Column "job" -->
        <ng-container matColumnDef="job">
          <th mat-header-cell *matHeaderCellDef class="f-w-600 mat-subtitle-1 f-s-14">Job</th>
          <td mat-cell *matCellDef="let element">
            <ng-container *ngIf="element.isEditing; else showJob">
              <input [(ngModel)]="element.job" />
            </ng-container>
            <ng-template #showJob>{{ element.job }}</ng-template>
          </td>
        </ng-container>
        
        <!-- Column "salary" -->
        <ng-container matColumnDef="salary">
          <th mat-header-cell *matHeaderCellDef class="f-w-600 mat-subtitle-1 f-s-14">Salaire</th>
          <td mat-cell *matCellDef="let element">
            <ng-container *ngIf="element.isEditing; else showSalary">
              <input [(ngModel)]="element.salary" />
            </ng-container>
            <ng-template #showSalary>{{ element.salary | currency }}</ng-template>
          </td>
        </ng-container>
<!-- Column "cin" -->
<ng-container matColumnDef="cin">
  <th mat-header-cell *matHeaderCellDef class="f-w-600 mat-subtitle-1 f-s-14">CIN</th>
  <td mat-cell *matCellDef="let element">
    <ng-container *ngIf="element.isEditing; else showCin">
      <input [(ngModel)]="element.cin" />
    </ng-container>
    <ng-template #showCin>{{ element.cin }}</ng-template>
  </td>
</ng-container>

        <!-- Column "balance" -->
        <ng-container matColumnDef="balance">
          <th mat-header-cell *matHeaderCellDef class="f-w-600 mat-subtitle-1 f-s-14">Balance</th>
          <td mat-cell *matCellDef="let element">
            <ng-container *ngIf="element.isEditing; else showBalance">
              <input [(ngModel)]="element.balance" />
            </ng-container>
            <ng-template #showBalance>{{ element.balance }}</ng-template>
          </td>
        </ng-container>

        <!-- Column "creditScore" -->
        <ng-container matColumnDef="creditScore">
          <th mat-header-cell *matHeaderCellDef class="f-w-600 mat-subtitle-1 f-s-14">Credit Score</th>
          <td mat-cell *matCellDef="let element">
            <ng-container *ngIf="element.isEditing; else showCreditScore">
              <input [(ngModel)]="element.creditScore" />
            </ng-container>
            <ng-template #showCreditScore>{{ element.creditScore }}</ng-template>
          </td>
        </ng-container>

        <!-- Column "rib" -->
        <ng-container matColumnDef="rib">
          <th mat-header-cell *matHeaderCellDef class="f-w-600 mat-subtitle-1 f-s-14">RIB</th>
          <td mat-cell *matCellDef="let element">
            <ng-container *ngIf="element.isEditing; else showRib">
              <input [(ngModel)]="element.rib" />
            </ng-container>
            <ng-template #showRib>{{ element.rib }}</ng-template>
          </td>
        </ng-container>

        <!-- Column "status" -->
        <ng-container matColumnDef="status">
          <th mat-header-cell *matHeaderCellDef class="f-w-600 mat-subtitle-1 f-s-14">Statut</th>
          <td mat-cell *matCellDef="let element">
            <ng-container *ngIf="element.isEditing; else showStatus">
              <input [(ngModel)]="element.status" />
            </ng-container>
            <ng-template #showStatus>{{ element.status }}</ng-template>
          </td>
        </ng-container>

        <!-- Column "actions" (Edit, Save, Cancel) -->
        <ng-container matColumnDef="actions">
          <th mat-header-cell *matHeaderCellDef class="f-w-600 mat-subtitle-1 f-s-14">Actions</th>
          <td mat-cell *matCellDef="let element">
            <!-- Bouton Modifier -->
            <button mat-icon-button color="primary" (click)="editUser(element)">
              <mat-icon>edit</mat-icon>
            </button>
          
            <!-- Bouton Sauvegarder (visible uniquement en mode édition) -->
            <button mat-icon-button color="accent" *ngIf="element.isEditing" (click)="saveUser(element)">
              <mat-icon>save</mat-icon>
            </button>
          
            <!-- Bouton Annuler (visible uniquement en mode édition) -->
            <button mat-icon-button color="warn" *ngIf="element.isEditing" (click)="cancelEdit(element)">
              <mat-icon>cancel</mat-icon>
            </button>
          
            <!-- Bouton Supprimer -->
            <button mat-icon-button color="warn" (click)="deleteUser(element.id)">
              <mat-icon>delete</mat-icon>
            </button>
          
            <!-- Bouton Ajouter -->
            <button mat-icon-button color="primary" [routerLink]="'/user/add'">
              <mat-icon>add</mat-icon>
            </button>
            
          </td>
          
        </ng-container>
        <!-- Add User Button -->
    

    <!-- Add User Form (visible only when showAddForm is true) -->
    <div *ngIf="showAddForm">
      <mat-form-field>
        <mat-label>Nom</mat-label>
        <input matInput [(ngModel)]="newUser.name">
      </mat-form-field>

      <mat-form-field>
        <mat-label>Prénom</mat-label>
        <input matInput [(ngModel)]="newUser.surname">
      </mat-form-field>

      <mat-form-field>
        <mat-label>Email</mat-label>
        <input matInput [(ngModel)]="newUser.email">
      </mat-form-field>

      <mat-form-field>
        <mat-label>Job</mat-label>
        <input matInput [(ngModel)]="newUser.job">
      </mat-form-field>

      <mat-form-field>
        <mat-label>Salaire</mat-label>
        <input matInput [(ngModel)]="newUser.salary">
      </mat-form-field>

      <mat-form-field>
        <mat-label>RIB</mat-label>
        <input matInput [(ngModel)]="newUser.rib">
      </mat-form-field>

      <button mat-raised-button color="primary" (click)="addUser()">Ajouter</button>
      <button mat-raised-button (click)="showAddForm = false">Annuler</button>
    </div>

        <!-- Table Header and Rows -->
        <tr mat-header-row *matHeaderRowDef="displayedColumns"></tr>
        <tr mat-row *matRowDef="let row; columns: displayedColumns"></tr>
      </table>
    </div>
   <!-- Section des statistiques -->
   <mat-card>
    <mat-card-header>
      <mat-card-title>Statistiques des utilisateurs</mat-card-title>
    </mat-card-header>
  
    <mat-card-content>
      <div class="statistics-container">
        <div class="stat-box">
          <mat-icon>group</mat-icon>
          <h3>Total des utilisateurs</h3>
          <p>{{ statistics.totalUsers }}</p>
        </div>
  
        
  
        <!-- Vous pouvez ajouter des graphiques avec des bibliothèques comme Chart.js ou ng2-charts -->
        
      </div>
    </mat-card-content>
  </mat-card>
  

  </mat-card-content>
</mat-card>
